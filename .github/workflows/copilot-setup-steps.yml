name: GitHub Copilot Setup Steps

# Documentation-only workflow with setup steps for new developers
on:
  workflow_dispatch:
    inputs:
      setup_type:
        description: 'Setup type to run'
        required: true
        default: 'full'
        type: choice
        options: [full, development, testing]

jobs:
  setup-documentation:
    runs-on: ubuntu-latest
    if: false  # Never runs; serves as documentation only
    steps:
      # ==========================
      # QUICK START SETUP STEPS
      # ==========================
      - name: "ðŸ“‹ Step 1: Clone Repository"
        run: |
          echo "git clone https://github.com/aecwells/hwautomation.git"
          echo "cd hwautomation"

      - name: "ðŸ Step 2: Setup Python Environment"
        run: |
          echo "# Create virtual environment"
          echo "python -m venv hwautomation-env"
          echo ""
          echo "# Activate virtual environment"
          echo "# Linux/Mac: source hwautomation-env/bin/activate"
          echo "# Windows:   hwautomation-env\\Scripts\\activate"

      - name: "ðŸ“¦ Step 3: Install Dependencies"
        run: |
          echo "# Install in development mode with all extras"
          echo "pip install -e .[dev]"
          echo ""
          echo "# Or install minimal requirements"
          echo "pip install -r requirements.txt"

      - name: "âš™ï¸ Step 4: Environment Configuration"
        run: |
          echo "# Copy example environment file"
          echo "cp .env.example .env"
          echo ""
          echo "# Edit .env with your settings:"
          echo "# - MAAS_URL=http://your-maas-server:5240/MAAS"
          echo "# - MAAS_CONSUMER_KEY=your_consumer_key"
          echo "# - MAAS_TOKEN_KEY=your_token_key"
          echo "# - MAAS_TOKEN_SECRET=your_token_secret"
          echo "# - DATABASE_PATH=./hw_automation.db"

      # ==========================
      # DEVELOPMENT SETUP STEPS
      # ==========================
      - name: "ðŸ› ï¸ Step 5: Development Tools Setup"
        run: |
          echo "# Install pre-commit hooks (optional)"
          echo "pre-commit install"
          echo ""
          echo "# Install additional development tools"
          echo "pip install black flake8 mypy pytest-cov"

      - name: "ðŸ—„ï¸ Step 6: Database Setup"
        run: |
          echo "# Initialize database (automatic on first run)"
          echo 'python -c "from hwautomation.database.helper import DbHelper; DbHelper(tablename=\'servers\', db_path=\'hw_automation.db\', auto_migrate=True)"'
          echo ""
          echo "# Or run the CLI"
          echo "python -m hwautomation.cli.main --help"

      - name: "ðŸ§ª Step 7: Run Tests"
        run: |
          echo "# Run unit tests"
          echo "pytest tests/unit/ -v"
          echo ""
          echo "# Run tests with coverage"
          echo "pytest tests/unit/ --cov=src/hwautomation --cov-report=html"
          echo ""
          echo "# Run all tests (including integration)"
          echo "pytest tests/ -v"

      # ==========================
      # CONTAINER SETUP STEPS
      # ==========================
      - name: "ðŸ³ Step 8: Docker Setup (Alternative)"
        run: |
          echo "# Build and start with Docker Compose"
          echo "docker compose up -d app"
          echo ""
          echo "# View logs"
          echo "docker compose logs -f app"
          echo ""
          echo "# Access container shell"
          echo "docker compose exec app bash"
          echo ""
          echo "# Stop containers"
          echo "docker compose down"

      # ==========================
      # WEB INTERFACE SETUP
      # ==========================
      - name: "ðŸŒ Step 9: Web Interface"
        run: |
          echo "# Start the web interface"
          echo "python -m hwautomation.web"
          echo ""
          echo "# Access dashboard at: http://localhost:5000"

      # ==========================
      # USAGE EXAMPLES
      # ==========================
      - name: "ðŸ“š Step 10: Basic Usage Examples"
        run: |
          echo "# List and run examples with the unified runner"
          echo "python examples/run.py --list"
          echo "python examples/run.py firmware_manager_demo"
          echo "python examples/run.py firmware_provisioning_demo"

      # ==========================
      # TROUBLESHOOTING STEPS
      # ==========================
      - name: "ðŸ”§ Step 11: Troubleshooting"
        run: |
          echo "# Common issues and solutions:"
          echo ""
          echo "1. Database migration errors:"
          echo "   - Delete hw_automation.db and restart"
          echo "   - Check DATABASE_PATH in .env"
          echo ""
          echo "2. MaaS connection issues:"
          echo "   - Verify MAAS_URL is accessible"
          echo "   - Check OAuth credentials"
          echo "   - Use examples/redfish_example.py for Redfish connectivity checks"
          echo ""
          echo "3. Test failures:"
          echo "   - Update device types in test files"
          echo "   - Check .env TESTING=true is set"
          echo "   - Run: pytest tests/unit/ --tb=short"
          echo ""
          echo "4. Import errors:"
          echo "   - Install in development mode: pip install -e ."
          echo "   - Check Python path and virtual environment"

      # ==========================
      # DEVELOPMENT WORKFLOW
      # ==========================
      - name: "ðŸ”„ Step 12: Development Workflow"
        run: |
          echo "# Recommended development workflow:"
          echo ""
          echo "1. Create feature branch:"
          echo "   git checkout -b feature/your-feature"
          echo ""
          echo "2. Make changes and test:"
          echo "   pytest tests/unit/ -v"
          echo ""
          echo "3. Run code quality checks:"
          echo "   black src/ tests/"
          echo "   flake8 src/ tests/"
          echo ""
          echo "4. Commit and push:"
          echo "   git add ."
          echo "   git commit -m 'Add your feature'"
          echo "   git push origin feature/your-feature"
          echo ""
          echo "5. Create pull request on GitHub"

      # ==========================
      # USEFUL COMMANDS
      # ==========================
      - name: "âš¡ Step 13: Useful Commands"
        run: |
          echo "# Project-specific commands:"
          echo ""
          echo "# CLI:"
          echo "hw-cli --help"
          echo ""
          echo "# Web:"
          echo "hw-web"
          echo ""
          echo "# Examples:"
          echo "python examples/run.py --list"

  # ===========================================
  # ACTUAL SETUP VALIDATION (Optional)
  # ===========================================
  validate-setup:
    runs-on: ubuntu-latest
    if: github.event.inputs.setup_type == 'full'
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -e .[dev]

      - name: Create test environment
        run: |
          echo "PROJECT_NAME=hwautomation" > .env
          echo "DATABASE_PATH=:memory:" >> .env
          echo "TESTING=true" >> .env
          echo "DEVELOPMENT_MOCK_SERVICES=true" >> .env

      - name: Validate basic imports
        run: |
          python -c "from hwautomation.orchestration.workflow_manager import WorkflowManager; print('âœ… Orchestration imports work')"
          python -c "from hwautomation.hardware.bios_config import BiosConfigManager; print('âœ… Hardware imports work')"
          python -c "from hwautomation.maas.client import MaasClient; print('âœ… MaaS imports work')"
          python -c "from hwautomation.database.helper import DbHelper; print('âœ… Database imports work')"

      - name: Run quick tests
        run: |
          pytest tests/unit/ -x --tb=short -q
          echo "âœ… Unit tests pass"

      - name: Validate examples
        run: |
          python -c "import examples.basic_usage; print('âœ… Examples can be imported')"

      - name: Setup validation complete
        run: |
          echo "ðŸŽ‰ Setup validation completed successfully!"
          echo "Your development environment is ready for HWAutomation."
