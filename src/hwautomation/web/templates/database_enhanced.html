{% extends "base.html" %}

{% block title %}Database Management - HWAutomation GUI{% endblock %}

{% block extra_head %}
<style>
    /* Theme-aware CSS custom properties */
    :root[data-bs-theme="light"] {
        --db-card-bg: #ffffff;
        --db-card-border: #dee2e6;
        --db-card-hover-border: #0d6efd;
        --db-field-group-bg: #f8f9fa;
        --db-field-group-border: #0d6efd;
        --db-text-primary: #212529;
        --db-text-secondary: #6c757d;
        --db-text-muted: #6c757d;
        --db-hover-bg: #e9ecef;
        --db-hover-text: #495057;
        --db-table-header-bg: #f8f9fa;
        --db-shadow: rgba(0,0,0,0.1);
    }
    
    :root[data-bs-theme="dark"] {
        --db-card-bg: #343a40;
        --db-card-border: #495057;
        --db-card-hover-border: #0d6efd;
        --db-field-group-bg: #495057;
        --db-field-group-border: #0d6efd;
        --db-text-primary: #dee2e6;
        --db-text-secondary: #adb5bd;
        --db-text-muted: #6c757d;
        --db-hover-bg: #495057;
        --db-hover-text: #f8f9fa;
        --db-table-header-bg: #495057;
        --db-shadow: rgba(0,0,0,0.3);
    }
    
    .column-group-toggle {
        border: none;
        background: none;
        color: var(--db-text-muted);
        padding: 0.25rem 0.5rem;
        margin: 0.1rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
        transition: all 0.2s ease;
    }
    
    .column-group-toggle:hover {
        background-color: var(--db-hover-bg);
        color: var(--db-hover-text);
    }
    
    .column-group-toggle.active {
        background-color: #0d6efd;
        color: white;
    }
    
    .server-card {
        transition: all 0.2s ease;
        border: 1px solid var(--db-card-border);
        background-color: var(--db-card-bg);
        color: var(--db-text-primary);
    }
    
    .server-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--db-shadow);
        border-color: var(--db-card-hover-border);
    }
    
    .column-hidden {
        display: none !important;
    }
    
    .text-null {
        color: var(--db-text-muted);
        font-style: italic;
    }
    
    .text-timestamp {
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        color: var(--db-text-secondary);
    }
    
    .status-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
    
    .truncate-text {
        max-width: 150px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .field-group {
        background-color: var(--db-field-group-bg);
        padding: 0.75rem;
        margin-bottom: 0.75rem;
        border-radius: 0.375rem;
        border-left: 3px solid var(--db-field-group-border);
    }
    
    .field-group h6 {
        color: var(--db-field-group-border);
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    .field-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.25rem 0;
        border-bottom: 1px solid var(--db-card-border);
    }
    
    .field-row:last-child {
        border-bottom: none;
    }
    
    .field-label {
        font-weight: 500;
        color: var(--db-text-secondary);
        min-width: 120px;
    }
    
    .field-value {
        color: var(--db-text-primary);
        text-align: right;
    }
    
    /* Enhanced table styling for dark mode */
    .table-responsive {
        background-color: var(--db-card-bg);
        border-radius: 0.375rem;
    }
    
    .sticky-top {
        background-color: var(--db-table-header-bg) !important;
        color: var(--db-text-primary);
    }
    
    /* Card view container styling */
    #cardViewContainer {
        background-color: var(--bs-body-bg);
    }
    
    /* Loading and empty states */
    #loadingState, #emptyState {
        color: var(--db-text-secondary);
    }
    
    /* Form controls theme support */
    .form-select, .form-control {
        background-color: var(--bs-body-bg);
        border-color: var(--db-card-border);
        color: var(--db-text-primary);
    }
    
    .form-select:focus, .form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    /* Dropdown menu theme support */
    .dropdown-menu {
        background-color: var(--db-card-bg);
        border-color: var(--db-card-border);
        color: var(--db-text-primary);
    }
    
    .dropdown-header {
        color: var(--db-text-secondary);
    }
    
    .form-check-label {
        color: var(--db-text-primary);
    }
    
    /* Badge theme support */
    .badge.bg-light {
        background-color: var(--db-field-group-bg) !important;
        color: var(--db-text-primary) !important;
    }
    
    /* Button theme adjustments */
    .btn-outline-secondary:hover {
        background-color: var(--db-hover-bg);
        border-color: var(--db-card-border);
        color: var(--db-hover-text);
    }
    
    /* Improved contrast for small text */
    .text-muted {
        color: var(--db-text-muted) !important;
    }
    
    /* Enhanced card footer styling */
    .card-footer {
        background-color: var(--db-field-group-bg);
        border-top: 1px solid var(--db-card-border);
    }
    
    /* Statistics cards theme support */
    .card-body h4 {
        color: var(--db-text-primary);
    }
    
    .card-text {
        color: var(--db-text-secondary);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="h3 mb-4">
                <i class="bi bi-database"></i> Database Management
            </h1>
        </div>
    </div>

    <!-- Database Overview Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h4 class="text-primary" id="total-servers">0</h4>
                    <p class="card-text">Total Servers</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h4 class="text-success" id="ready-servers">0</h4>
                    <p class="card-text">Ready Servers</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h4 class="text-warning" id="commissioning-servers">0</h4>
                    <p class="card-text">Commissioning</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h4 class="text-info" id="schema-version">0</h4>
                    <p class="card-text">Schema Version</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Table Display -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center gap-3">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-table"></i> Server Database
                            </h5>
                            <select class="form-select form-select-sm" id="tableSelector" style="width: auto;" onchange="loadTableData()">
                                <option value="servers">Servers</option>
                                <option value="workflow_history">Workflow History</option>
                                <option value="power_state_history">Power History</option>
                                <option value="schema_migrations">Migrations</option>
                            </select>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <!-- View Mode Toggle -->
                            <div class="btn-group btn-group-sm" role="group">
                                <input type="radio" class="btn-check" name="viewMode" id="tableView" autocomplete="off" checked>
                                <label class="btn btn-outline-primary" for="tableView" onclick="switchView('table')">
                                    <i class="bi bi-table"></i> Table
                                </label>
                                <input type="radio" class="btn-check" name="viewMode" id="cardView" autocomplete="off">
                                <label class="btn btn-outline-primary" for="cardView" onclick="switchView('cards')">
                                    <i class="bi bi-grid-3x3-gap"></i> Cards
                                </label>
                            </div>
                            
                            <!-- Column Groups -->
                            <div class="dropdown">
                                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" 
                                        data-bs-toggle="dropdown">
                                    <i class="bi bi-columns-gap"></i> Columns
                                </button>
                                <div class="dropdown-menu dropdown-menu-end p-3" style="min-width: 320px;">
                                    <h6 class="dropdown-header">Show/Hide Column Groups</h6>
                                    <div id="columnGroupControls">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-success btn-sm" onclick="refreshData()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <!-- Search and Filters -->
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="input-group input-group-sm">
                                <span class="input-group-text">
                                    <i class="bi bi-search"></i>
                                </span>
                                <input type="text" class="form-control" id="searchInput" 
                                       placeholder="Search servers..." onkeyup="filterData()">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select form-select-sm" id="statusFilter" onchange="filterData()">
                                <option value="">All Status</option>
                                <option value="Ready">Ready</option>
                                <option value="Deployed">Deployed</option>
                                <option value="Commissioning">Commissioning</option>
                                <option value="Failed">Failed</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select form-select-sm" id="deviceTypeFilter" onchange="filterData()">
                                <option value="">All Device Types</option>
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div class="col-md-2">
                            <div class="text-muted small">
                                <span id="resultCount">0</span> results
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    <!-- Table View -->
                    <div id="tableViewContainer">
                        <div class="table-responsive" style="max-height: 70vh;">
                            <table class="table table-sm table-hover mb-0" id="serversTable">
                                <thead class="sticky-top bg-light" id="tableHead">
                                    <!-- Populated by JavaScript -->
                                </thead>
                                <tbody id="tableBody">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Card View -->
                    <div id="cardViewContainer" style="display: none;">
                        <div class="row g-3 p-3" id="cardContent">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Loading State -->
                    <div id="loadingState" class="text-center p-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2 text-muted">Loading data...</p>
                    </div>
                    
                    <!-- Empty State -->
                    <div id="emptyState" class="text-center p-4" style="display: none;">
                        <i class="bi bi-database text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3 text-muted">No Data Found</h5>
                        <p class="text-muted">No records match your current filters.</p>
                        <button class="btn btn-outline-primary btn-sm" onclick="refreshData()">
                            <i class="bi bi-arrow-clockwise"></i> Refresh Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Define column groups for better organization
const COLUMN_GROUPS = {
    'basic': {
        name: 'Basic Info',
        columns: ['server_id', 'device_type', 'server_type', 'status_name', 'server_model'],
        color: '#0d6efd',
        visible: true
    },
    'network': {
        name: 'Network',
        columns: ['ip_address', 'ip_address_works', 'ipmi_address', 'ipmi_address_works'],
        color: '#198754',
        visible: true
    },
    'workflow': {
        name: 'Workflow',
        columns: ['workflow_status', 'commissioning_status', 'assigned_role', 'deployment_status'],
        color: '#fd7e14',
        visible: true
    },
    'hardware': {
        name: 'Hardware',
        columns: ['cpu_model', 'memory_gb', 'storage_info', 'firmware_version'],
        color: '#6610f2',
        visible: false
    },
    'ipmi': {
        name: 'IPMI/BMC',
        columns: ['ipmi_username', 'ipmi_configured', 'redfish_available', 'power_state'],
        color: '#d63384',
        visible: false
    },
    'config': {
        name: 'Configuration',
        columns: ['bios_config_applied', 'bios_config_version', 'bios_password_set'],
        color: '#20c997',
        visible: false
    },
    'timestamps': {
        name: 'Timestamps',
        columns: ['created_at', 'updated_at', 'last_seen', 'last_workflow_run'],
        color: '#6c757d',
        visible: false
    },
    'metadata': {
        name: 'Metadata',
        columns: ['rack_location', 'tags', 'notes', 'provisioning_target'],
        color: '#fd7e14',
        visible: false
    }
};

let currentData = [];
let filteredData = [];
let currentView = 'table';

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    initializeColumnControls();
    loadTableData();
    
    // Initialize theme-aware elements
    updateThemeAwareElements();
    
    // Listen for theme changes
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'data-bs-theme') {
                updateThemeAwareElements();
            }
        });
    });
    
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-bs-theme']
    });
});

function updateThemeAwareElements() {
    const isDark = document.documentElement.getAttribute('data-bs-theme') === 'dark';
    
    // Update any theme-specific elements if needed
    const loadingSpinner = document.querySelector('.spinner-border');
    if (loadingSpinner) {
        loadingSpinner.className = isDark ? 'spinner-border text-light' : 'spinner-border text-primary';
    }
    
    // Update empty state icon color
    const emptyIcon = document.querySelector('#emptyState i');
    if (emptyIcon) {
        emptyIcon.style.color = isDark ? '#495057' : '#dee2e6';
    }
}

function initializeColumnControls() {
    const container = document.getElementById('columnGroupControls');
    
    for (const [groupId, group] of Object.entries(COLUMN_GROUPS)) {
        const div = document.createElement('div');
        div.className = 'form-check mb-2';
        div.innerHTML = `
            <input class="form-check-input" type="checkbox" id="group_${groupId}" 
                   ${group.visible ? 'checked' : ''} onchange="toggleColumnGroup('${groupId}')">
            <label class="form-check-label d-flex justify-content-between align-items-center" for="group_${groupId}">
                <span class="d-flex align-items-center">
                    <i class="bi bi-circle-fill me-2" style="font-size: 0.5rem; color: ${group.color};"></i>
                    <span>${group.name}</span>
                </span>
                <span class="badge bg-secondary">${group.columns.length}</span>
            </label>
        `;
        container.appendChild(div);
    }
}

function toggleColumnGroup(groupId) {
    const checkbox = document.getElementById(`group_${groupId}`);
    COLUMN_GROUPS[groupId].visible = checkbox.checked;
    
    if (currentView === 'table') {
        updateTableDisplay();
    } else {
        displayCards();
    }
}

function switchView(viewType) {
    currentView = viewType;
    
    if (viewType === 'table') {
        document.getElementById('tableViewContainer').style.display = 'block';
        document.getElementById('cardViewContainer').style.display = 'none';
        updateTableDisplay();
    } else {
        document.getElementById('tableViewContainer').style.display = 'none';
        document.getElementById('cardViewContainer').style.display = 'block';
        displayCards();
    }
}

function loadTableData() {
    const table = document.getElementById('tableSelector').value;
    showLoading();
    
    fetch(`/api/database/table/${table}/data`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                currentData = data.data || [];
                filteredData = [...currentData];
                updateStats();
                updateDeviceTypeFilter();
                
                if (currentView === 'table') {
                    updateTableDisplay();
                } else {
                    displayCards();
                }
                
                updateResultCount();
                hideLoading();
            } else {
                showError(data.error || 'Failed to load data');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showError('Network error loading data');
        });
}

function updateTableDisplay() {
    const thead = document.getElementById('tableHead');
    const tbody = document.getElementById('tableBody');
    
    // Get visible columns
    const visibleColumns = [];
    for (const [groupId, group] of Object.entries(COLUMN_GROUPS)) {
        if (group.visible) {
            visibleColumns.push(...group.columns);
        }
    }
    
    // Create header
    thead.innerHTML = `
        <tr>
            ${visibleColumns.map(col => `<th class="text-nowrap">${formatColumnName(col)}</th>`).join('')}
            <th width="100">Actions</th>
        </tr>
    `;
    
    // Create rows
    tbody.innerHTML = '';
    filteredData.forEach((row, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            ${visibleColumns.map(col => {
                const value = formatCellValue(row[col], col);
                return `<td class="truncate-text" title="${row[col] || 'NULL'}">${value}</td>`;
            }).join('')}
            <td>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary btn-sm" onclick="viewRecord(${index})" 
                            title="View Details" aria-label="View record details">
                        <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="editRecord(${index})" 
                            title="Edit" aria-label="Edit record">
                        <i class="bi bi-pencil"></i>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function displayCards() {
    const container = document.getElementById('cardContent');
    container.innerHTML = '';
    
    filteredData.forEach((server, index) => {
        const card = createServerCard(server, index);
        const col = document.createElement('div');
        col.className = 'col-lg-4 col-md-6';
        col.appendChild(card);
        container.appendChild(col);
    });
}

function createServerCard(server, index) {
    const card = document.createElement('div');
    card.className = 'card server-card h-100';
    
    const statusColor = getStatusColor(server.status_name);
    const workflowColor = getWorkflowStatusColor(server.workflow_status);
    
    card.innerHTML = `
        <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0">
                <i class="bi bi-server"></i> ${server.server_id || 'Unknown ID'}
            </h6>
            <div class="d-flex gap-1">
                <span class="badge ${statusColor}">${server.status_name || 'Unknown'}</span>
                ${server.workflow_status ? `<span class="badge ${workflowColor}">${server.workflow_status}</span>` : ''}
            </div>
        </div>
        
        <div class="card-body">
            <!-- Basic Information -->
            <div class="field-group">
                <h6><i class="bi bi-info-circle"></i> Basic Info</h6>
                <div class="field-row">
                    <span class="field-label">Device Type:</span>
                    <span class="field-value">${server.device_type || 'Not set'}</span>
                </div>
                <div class="field-row">
                    <span class="field-label">Server Type:</span>
                    <span class="field-value">${server.server_type || 'Not set'}</span>
                </div>
                <div class="field-row">
                    <span class="field-label">Model:</span>
                    <span class="field-value">${server.server_model || 'Unknown'}</span>
                </div>
            </div>
            
            <!-- Network Information -->
            ${server.ip_address ? `
            <div class="field-group">
                <h6><i class="bi bi-network-widescreen"></i> Network</h6>
                <div class="field-row">
                    <span class="field-label">IP Address:</span>
                    <span class="field-value">${server.ip_address}</span>
                </div>
                ${server.ipmi_address ? `
                <div class="field-row">
                    <span class="field-label">IPMI Address:</span>
                    <span class="field-value">${server.ipmi_address}</span>
                </div>
                ` : ''}
            </div>
            ` : ''}
            
            <!-- Workflow Information -->
            ${(server.assigned_role || server.commissioning_status) ? `
            <div class="field-group">
                <h6><i class="bi bi-diagram-3"></i> Workflow</h6>
                ${server.assigned_role ? `
                <div class="field-row">
                    <span class="field-label">Role:</span>
                    <span class="field-value">${server.assigned_role}</span>
                </div>
                ` : ''}
                ${server.commissioning_status ? `
                <div class="field-row">
                    <span class="field-label">Commissioning:</span>
                    <span class="field-value">${server.commissioning_status}</span>
                </div>
                ` : ''}
            </div>
            ` : ''}
        </div>
        
        <div class="card-footer">
            <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                    Updated: ${server.updated_at ? new Date(server.updated_at).toLocaleDateString() : 'Never'}
                </small>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="viewRecord(${index})" 
                            aria-label="View record details">
                        <i class="bi bi-eye"></i> View
                    </button>
                    <button class="btn btn-outline-secondary" onclick="editRecord(${index})" 
                            aria-label="Edit record">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                </div>
            </div>
        </div>
    `;
    
    return card;
}

function formatColumnName(column) {
    return column.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
}

function formatCellValue(value, column) {
    if (value === null || value === undefined || value === '') {
        return '<span class="text-null">NULL</span>';
    }
    
    if (column.includes('_at') && value) {
        return `<span class="text-timestamp">${new Date(value).toLocaleDateString()}</span>`;
    }
    
    if (column === 'status_name') {
        const color = getStatusColor(value);
        return `<span class="badge ${color}">${value}</span>`;
    }
    
    if (column === 'workflow_status' && value) {
        const color = getWorkflowStatusColor(value);
        return `<span class="badge ${color}">${value}</span>`;
    }
    
    if (typeof value === 'string' && value.length > 30) {
        return value.substring(0, 30) + '...';
    }
    
    return value;
}

function getStatusColor(status) {
    // Use Bootstrap's semantic colors that work well in both themes
    switch (status?.toLowerCase()) {
        case 'ready': return 'bg-success text-white';
        case 'deployed': return 'bg-primary text-white';
        case 'commissioning': return 'bg-warning text-dark';
        case 'failed': case 'failed commissioning': return 'bg-danger text-white';
        default: return 'bg-secondary text-white';
    }
}

function getWorkflowStatusColor(status) {
    // Use Bootstrap's semantic colors that work well in both themes
    switch (status?.toLowerCase()) {
        case 'completed': return 'bg-success text-white';
        case 'running': return 'bg-info text-white';
        case 'pending': return 'bg-warning text-dark';
        case 'failed': return 'bg-danger text-white';
        default: return 'bg-secondary text-white';
    }
}

function filterData() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const statusFilter = document.getElementById('statusFilter').value;
    const deviceTypeFilter = document.getElementById('deviceTypeFilter').value;
    
    filteredData = currentData.filter(server => {
        // Search filter
        const matchesSearch = !searchTerm || Object.values(server).some(value => 
            value && value.toString().toLowerCase().includes(searchTerm)
        );
        
        // Status filter
        const matchesStatus = !statusFilter || server.status_name === statusFilter;
        
        // Device type filter
        const matchesDeviceType = !deviceTypeFilter || server.device_type === deviceTypeFilter;
        
        return matchesSearch && matchesStatus && matchesDeviceType;
    });
    
    updateResultCount();
    
    if (currentView === 'table') {
        updateTableDisplay();
    } else {
        displayCards();
    }
}

function updateStats() {
    const totalServers = currentData.length;
    const readyServers = currentData.filter(s => s.status_name === 'Ready').length;
    const commissioningServers = currentData.filter(s => s.status_name === 'Commissioning').length;
    
    document.getElementById('total-servers').textContent = totalServers;
    document.getElementById('ready-servers').textContent = readyServers;
    document.getElementById('commissioning-servers').textContent = commissioningServers;
}

function updateDeviceTypeFilter() {
    const select = document.getElementById('deviceTypeFilter');
    const deviceTypes = [...new Set(currentData.map(s => s.device_type).filter(Boolean))];
    
    select.innerHTML = '<option value="">All Device Types</option>';
    deviceTypes.forEach(type => {
        select.innerHTML += `<option value="${type}">${type}</option>`;
    });
}

function updateResultCount() {
    document.getElementById('resultCount').textContent = filteredData.length;
}

function refreshData() {
    loadTableData();
}

function showLoading() {
    document.getElementById('loadingState').style.display = 'block';
    document.getElementById('tableViewContainer').style.display = 'none';
    document.getElementById('cardViewContainer').style.display = 'none';
    document.getElementById('emptyState').style.display = 'none';
}

function hideLoading() {
    document.getElementById('loadingState').style.display = 'none';
    if (currentView === 'table') {
        document.getElementById('tableViewContainer').style.display = 'block';
    } else {
        document.getElementById('cardViewContainer').style.display = 'block';
    }
}

function showError(message) {
    console.error('Database error:', message);
    // Could show a toast or alert here
}

function viewRecord(index) {
    const server = filteredData[index];
    // TODO: Implement detailed view modal
    console.log('View server:', server);
}

function editRecord(index) {
    const server = filteredData[index];
    // TODO: Implement edit modal
    console.log('Edit server:', server);
}
</script>
{% endblock %}
