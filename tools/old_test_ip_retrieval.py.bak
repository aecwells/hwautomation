#!/usr/bin/env python3

from src.hwautomation.maas.client import create_maas_client
from src.hwautomation.utils.config import load_config

def test_ip_retrieval():
    config = load_config('/home/ubuntu/HWAutomation/config.yaml')
    maas_client = create_maas_client(config['maas'])

    # Test getting IP for machine 4af348
    ip = maas_client.get_machine_ip('4af348')
    print(f'IP for 4af348: {ip}')

    # Also test getting machine details
    machine = maas_client.get_machine('4af348')
    if machine:
        print(f'Machine status: {machine.get("status_name", "Unknown")}')
        print(f'Machine hostname: {machine.get("hostname", "Unknown")}')
        
        # Debug interface structure
        interfaces = machine.get('interface_set', [])
        print(f'Number of interfaces: {len(interfaces)}')
        for i, interface in enumerate(interfaces):
            print(f'Interface {i}: {interface.get("name", "Unknown")}')
            discovered = interface.get('discovered', [])
            links = interface.get('links', [])
            print(f'  Discovered IPs: {len(discovered)}')
            print(f'  Links: {len(links)}')
            
            for d in discovered:
                if 'ip_address' in d:
                    print(f'    Discovered IP: {d["ip_address"]}')
            
            for l in links:
                if 'ip_address' in l:
                    print(f'    Link IP: {l["ip_address"]}')
    else:
        print('Machine not found')

if __name__ == '__main__':
    test_ip_retrieval()
